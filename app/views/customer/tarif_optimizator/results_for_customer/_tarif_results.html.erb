<%
table.init do |t|
  t.caption = 'Затраты по отдельным услугам'
  t.base_name = 'service_results'
  t.current_id_name = 'service_id'
  t.pagination_per_page = 20
  t.id_name = 'service_id'  
  model_keys = t.model.collect {|row| row.keys }.flatten.uniq.collect{|key| key unless [].include?(key)}.compact  
  t.heads = ['Услуга', 'Стоимость в месяц, руб', 'Кол-во обработанных записей', 'Кол-во минут', 'Кол-во смс и ммс', 'Объем интернета, Мб']
  t.set_fields do |f| 
  	service_id = f['service_id'].to_s if f['service_id']
  	service_name = (f['service_description'][service_id]['name'] if f and service_id and f['service_description'] and f['service_description'][service_id])
  	service_http = (f['service_description'][service_id]['http'] if f and service_id and f['service_description'] and f['service_description'][service_id])
  	service_cost = (f['price_value'].to_f.round(0) if f and f['price_value'])
  	service_count = (f['call_id_count'].to_i if f and f['call_id_count'])

    if f and f['stat_results']
    	calls_volume = f['stat_results']['sum_duration_minute'].round(0) if f['stat_results']['sum_duration_minute']
    	sms_volume = f['stat_results']['count_volume'].round(0) if f['stat_results']['count_volume']
    	internet_volume = f['stat_results']['sum_volume'].round(0) if f['stat_results']['sum_volume']
    end
     
  	[
  	 link_to_if(service_http, service_name, service_http),    
     service_cost,      
     service_count,      
     calls_volume,
     sms_volume,
     internet_volume,
#     f['stat_results'],
#	 model_keys,    
  	] 
  end	
end
%>



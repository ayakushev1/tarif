<%
form_item.init do |f|
#  f.caption = "Filtr fields"	
  f.set_fields do |filtr_name|
    s = session[:filtr][filtr_name]
    query = Customer::Call.query_hash_from_filtr_with_all_keys_excluded(session[:filtr][filtr_name])
    user_calls_query = Customer::Call.where(:user_id => controller.current_user.id)
    action_name = customer_calls_path
  [
  	["", collection_select(filtr_name, "base_service_id", Category.where(:id => user_calls_query.query_from_filtr(s, "base_service_id").pluck(:base_service_id).uniq ), :id, :name, 
  	   {:include_blank => "base service", :selected => s["base_service_id"] }, {:action_name => action_name} )
  	],
  	["", collection_select(filtr_name, "base_subservice_id", Category.where(:id => user_calls_query.query_from_filtr(s, "base_subservice_id").pluck(:base_subservice_id).uniq ), :id, :name, 
  	   {:include_blank => "base subservice", :selected => s["base_subservice_id"] }, {:action_name => action_name} )
  	],
  	["", collection_select(filtr_name, "user_id", User.where(:id => user_calls_query.query_from_filtr(s, "user_id").pluck(:user_id).uniq ), :id, :name, 
  	   {:include_blank => "user", :selected => s["user_id"] }, {:action_name => action_name} )
  	],
  	["", select(filtr_name, "own_phone[number]", user_calls_query.query_from_filtr(s, "own_phone[number]").collect { |q| q.own_phone['number'] }.uniq , 
  	   {:include_blank => "own_phone[number]", :selected => (s["own_phone"]["number"] if s["own_phone"] )}, {:action_name => action_name} )
  	],
  	["", collection_select(filtr_name, "own_phone[operator_id]", Category.where(:id => user_calls_query.query_from_filtr(s, "own_phone[operator_id]").collect { |q| q.own_phone['operator_id'] }.uniq ) , :id, :name, 
  	   {:include_blank => "own_phone[operator_id]", :selected => (s["own_phone"]["operator_id"] if s["own_phone"] )}, {:action_name => action_name} )
  	],
  	["", collection_select(filtr_name, "own_phone[region_id]", Category.where(:id => user_calls_query.query_from_filtr(s, "own_phone[region_id]").collect { |q| q.own_phone['region_id'] }.uniq ) , :id, :name, 
  	   {:include_blank => "own_phone[region_id]", :selected => (s["own_phone"]["region_id"] if s["own_phone"] )}, {:action_name => action_name} )
  	],
  	["", collection_select(filtr_name, "own_phone[country_id]", Category.where(:id => user_calls_query.query_from_filtr(s, "own_phone[country_id]").collect { |q| q.own_phone['country_id'] }.uniq ) , :id, :name, 
  	   {:include_blank => "own_phone[country_id]", :selected => (s["own_phone"]["country_id"] if s["own_phone"] )}, {:action_name => action_name} )
  	],
  	["", select(filtr_name, "partner_phone[number]", user_calls_query.query_from_filtr(s, "partner_phone[number]").collect { |q| q.partner_phone['number'] }.uniq , 
  	   {:include_blank => "partner_phone[number]", :selected => (s["partner_phone"]["number"] if s["partner_phone"] )}, {:action_name => action_name} )
  	],
  	["", collection_select(filtr_name, "partner_phone[operator_id]", Category.where(:id => user_calls_query.query_from_filtr(s, "partner_phone[operator_id]").collect { |q| q.partner_phone['operator_id'] }.uniq ) , :id, :name, 
  	   {:include_blank => "partner_phone[operator_id]", :selected => (s["partner_phone"]["operator_id"] if s["partner_phone"] )}, {:action_name => action_name} )
  	],
  	["", collection_select(filtr_name, "partner_phone[operator_type_id]", Category.where(:id => user_calls_query.query_from_filtr(s, "partner_phone[operator_type_id]").collect { |q| q.partner_phone['operator_type_id'] }.uniq ) , :id, :name, 
  	   {:include_blank => "partner_phone[operator_type_id]", :selected => (s["partner_phone"]["operator_type_id"] if s["partner_phone"] )}, {:action_name => action_name} )
  	],
  	["", collection_select(filtr_name, "partner_phone[region_id]", Category.where(:id => user_calls_query.query_from_filtr(s, "partner_phone[region_id]").collect { |q| q.partner_phone['region_id'] }.uniq ) , :id, :name, 
  	   {:include_blank => "partner_phone[region_id]", :selected => (s["partner_phone"]["region_id"] if s["partner_phone"] )}, {:action_name => action_name} )
  	],   
  	["", collection_select(filtr_name, "partner_phone[country_id]", Category.where(:id => user_calls_query.query_from_filtr(s, "partner_phone[country_id]").collect { |q| q.partner_phone['country_id'] }.uniq ) , :id, :name, 
  	   {:include_blank => "partner_phone[country_id]", :selected => (s["partner_phone"]["country_id"] if s["partner_phone"] )}, {:action_name => action_name} )
  	],   
  	["", collection_select(filtr_name, "connect[operator_id]", Category.where(:id => user_calls_query.query_from_filtr(s, "connect[operator_id]").collect { |q| q.connect['operator_id'] }.uniq ) , :id, :name, 
  	   {:include_blank => "connect[operator_id]", :selected => (s["connect"]["operator_id"] if s["connect"] )}, {:action_name => action_name} )
  	],
  	["", collection_select(filtr_name, "connect[region_id]", Category.where(:id => user_calls_query.query_from_filtr(s, "connect[region_id]").collect { |q| q.connect['region_id'] }.uniq ) , :id, :name, 
  	   {:include_blank => "connect[region_id]", :selected => (s["connect"]["region_id"] if s["connect"] )}, {:action_name => action_name} )
  	],   
  	["", collection_select(filtr_name, "connect[country_id]", Category.where(:id => user_calls_query.query_from_filtr(s, "connect[country_id]").collect { |q| q.connect['country_id'] }.uniq ) , :id, :name, 
  	   {:include_blank => "connect[country_id]", :selected => (s["connect"]["country_id"] if s["connect"] )}, {:action_name => action_name} )
  	],   
  ] 
  end
end
%>

<%
  @heads = ['', 'Стоимость в месяц, руб', 'Оператор', 'Тариф', 'Общие услуги', 'Тарифные опции', 'Взаимозаменяемые опции']
  content_for :table_name, model.table_name
  content_for :caption,  model.table_name
  content_for :pagination, will_paginate(model, :class=>'pagination text-center pagin_border', :remote => true, :param_name => 'pagination_param_name')
  content_for :model, model

  s_desc = service_description(all_service_ids + identical_services)
  result = []
  model.each do |row|
	  	f = row
	  		
	    services = f.service_ids.map do |id|
	        link_to_if(s_desc[id]['service_http'], s_desc[id]['service_name'], s_desc[id]['service_http'], {:target => "_blank"})	
	    end.join(', ').html_safe if f.service_ids
	
	    common_services = f.common_services.map do |id|
	        link_to_if(s_desc[id]['service_http'], s_desc[id]['service_name'], s_desc[id]['service_http'], {:target => "_blank"})	
	    end.join(', ').html_safe if f.common_services
	
	    tarif_options = f.tarif_options.map do |id|
	        link_to_if(s_desc[id]['service_http'], s_desc[id]['service_name'], s_desc[id]['service_http'], {:target => "_blank"})	
	    end.join(', ').html_safe if f.tarif_options
	
	    identical_services = f.identical_services.map do |identical_service_group|
	    	identical_services_for_one_group = identical_service_group.map do |item|     	
	    		changed_item = item.is_a?(Array) ? item : [item]
	    		changed_item.map do |id|
	    			link_to_if(s_desc[id]['service_http'], s_desc[id]['service_name'], s_desc[id]['service_http'], {:target => "_blank"})
	    		end.join(' + ') if item	    	      	 
		    end.join(' или ') if identical_service_group
	        "[ #{identical_services_for_one_group} ]"
	    end.join(', ').html_safe if f.identical_services
	  		
	  		
	  		
	  result << content_tag(:tr) do
	     content_tag(:td, link_to( content_tag(:span, image_tag("left_menu_5.png", :alt => 'Подробное описание')), result_runs_detailed_results_path, {:remote => true}) ) +
	  	 content_tag(:td, (f.price.round(0).to_s(:delimited, precision: 0) if f.price) ) +    
	     content_tag(:td, (f.operator.name if f.operator) ) +     
	  	 content_tag(:td, link_to_if(s_desc[f.tarif_id]['service_http'], s_desc[f.tarif_id]['service_name'], s_desc[f.tarif_id]['service_http'], {:target => "_blank"}) ) +    
	     content_tag(:td, common_services ) +   
	     content_tag(:td, tarif_options ) +
	     content_tag(:td, identical_services ) +
	     content_tag(:td, (f.call_id_count if current_user_admin?) )   
	  end.html_safe
  end
%>
<%=  result.join(' ').html_safe %>

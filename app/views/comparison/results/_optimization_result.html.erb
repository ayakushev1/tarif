<%
table.init do |t|
  link_html = {:remote => true}
  t.heads = ['Модель поведения', '1', '2', '3', '4']
  
	tarifs = t.model.map{|result| result['place'].values.map{|place| place['tarif_id'] if result['place']}.compact }.flatten 
	tarifs_desc = {}
	TarifClass.where(:id => tarifs).each do |tarif|
		tarifs_desc[tarif.id] = tarif
	end

	operators_desc = {}
	operators = t.model.map{|result| result['place'].values.map{|place| place['operator_id'] if result['place']}.compact }.flatten
	Category.where(:id => operators).each do |operator|
		operators_desc[operator.id] = operator
	end
  
  t.set_fields do |result|   	
  	result_desc = result['place'].collect do |place, detail|
  		operator_desc = operators_desc[detail['operator_id']]
  		tarif_desc = tarifs_desc[detail['tarif_id']]
  		
  		link_to_if(tarif_desc.features['http'], "#{operator_desc.name} #{tarif_desc.name}", tarif_desc.features['http'], {:target => "_blank"}) +
  		content_tag(:p, "#{detail['price']} руб.") 	  		
  	end if result['place']

  [
    result['call_type_name'],
  ] + result_desc + (user_type != :admin ? [] : [
    result['optimization_list_key'],
    result['call_type'],
  	])
  end
end
%>
